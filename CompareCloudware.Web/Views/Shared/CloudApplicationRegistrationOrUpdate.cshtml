@model CompareCloudware.Web.Models.CloudApplicationRegistrationAndUpdateModel

@{
    //Layout = null;
}

@{this.ViewContext.FormContext = new FormContext();}

@*<!DOCTYPE html>*@

@*<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Popover Error Messages</title>
    </head>
    <body>
    </body>
</html>*@
        
@*        <link href="../../Content/twitter-bootstrap/resources/css/bootstrap.css" rel="stylesheet" media="screen">*@
@*        <link href="../../Content/twitter-bootstrap/resources/css/custom-bootstrap.css" rel="stylesheet" media="screen">*@
<div class="container">
    <div id="modalinput" class="modal hide fade in modal-cloudware-registration" style="display: none; ">
        <div class="modal-header">  
            <a class="close" data-dismiss="modal">×</a>  
        </div>  
        <div class="modal-body"> 
            <div class="row">
            @using (Html.BeginForm("dummy", "Home", FormMethod.Post, new { @id = "registerform" }))
            {
                <div class="span10 xoffset2">
@*                    <form id="registerform" class="form-inline" method="post">*@
                    <!-- HEADER CAPTIONS AND INPUT FIELDS-->
                    <div id="dummy" class="span7 xoffset2">
                        <fieldset>
                            @Html.HiddenFor(x => x.IsCloudwareUpdate)
                            @Html.HiddenFor(x => x.AutoShow)
                            <div class="register controls-row">
                                <label class="dummy-h1 clearfix">Cloudware registration</label>
                            </div>
                            <div class="register controls-row">
                                <h5 class="span6 clearfix">Register your cloudware for inclusion on Compare Cloudware and we'll get back to you with the marketing and affiliate options available for your portfolio</h5>
                            </div>
                            <div class="update controls-row">
                                <label class="dummy-h1 clearfix">Cloudware update</label>
                            </div>
                            <div class="update controls-row">
                                <h5 class="span6 clearfix">Let us know if you want to update your service proposition or positioning on Compare Cloudware</h5>
                            </div>
                        </fieldset>
                        <fieldset>
                            <div class="controls-row">        
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.Forename, new { @data_placement = "left", @placeholder = "  First name:" })
                                    </div>
                                </div>
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.EMail, new { @data_placement = "right", @placeholder = "  Work email:" })
                                    </div>
                                </div>
                            </div>
                            <div class="controls-row">        
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.Surname, new { @data_placement = "left", @placeholder = "  Surname:" })
                                    </div>
                                </div>
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.Telephone, new { @data_placement = "right", @placeholder = "  Telephone:" })
                                    </div>
                                </div>
                            </div>
                            <div class="controls-row">        
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.Position, new { @data_placement = "left", @placeholder = "  Position:" })
                                    </div>
                                </div>
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.Country, new { @data_placement = "right", @placeholder = "  Country:" })
                                    </div>
                                </div>
                            </div>
                            <div class="controls-row">        
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.Company, new { @data_placement = "left", @placeholder = "  Company:" })
                                    </div>
                                </div>
                                <div class="span3 control-group">
                                    <div class="controls">
                                        @Html.TextBoxFor(x => x.CloudApplicationServiceName, new { @data_placement = "right", @placeholder = "  Cloud service name:" })
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <!-- GRAPHIC -->
                    <div class="register sxpan2" style="width:209px;height:222px;float:left;">
                        <img src="@Url.Content("~/Images/Let-me-in.gif")" />
                    </div>
                    <div class="update sxpan2" style="width:209px;height:222px;float:left;">
                        <img src="@Url.Content("~/Images/Got-some-changes.gif")" />
                    </div>
                </div>
                <!-- SPACE -->
                <div class="span10" style="height:15px;"></div>
                <!-- CATEGORIES -->
                <div class=" register span10 xoffset2">
                @for (int i = 0; i <= Model.SupportCategories.Count; i++)
                {
                    if (i % 3 == 0 || i == 0)
                    {
                    @:<div class="span10 xoffset2">        
                    }
                            <div class="span3 control-group">
                               <div class="controls">
                                        @if (i < Model.SupportCategories.Count)
                                        {
                                        @Html.HiddenFor(x => x.SupportCategories[i].SupportCategoryID)
                                        @Html.HiddenFor(x => x.SupportCategories[i].SupportCategoryName)
                                        @Html.CheckBoxFor(x => x.SupportCategories[i].Selected)
                                        @Html.LabelFor(m => m.SupportCategories[i].SupportCategoryName, Model.SupportCategories[i].SupportCategoryName, new { @class = "font-normal-13px-black checkbox-label" })
                                        }
                                        else
                                        {
                                        @Html.TextBoxFor(x => x.SupportCategoryOther, new { @data_placement = "right", @placeholder = "  Other (please specify)" })
                                        }
                                </div>
                            </div>
                
                    if (i % 3 == 2 || i == Model.SupportCategories.Count)
                    {
                    @:</div>        
                    }
                }
                </div>
                <!-- UPDATE DETAILS SUMMARY -->
                <div class="update span10 xoffset2">
                    <div class="span10 xoffset2">
                        <fieldset>
                            <div class="controls-row">        
                                <div class="span10">
                                    <h5>Category, service and summary of details to be updated</h5>
                                </div>
                                <div class="span10 control-group">
                                    <div class="controls">
                                        @Html.TextAreaFor(x => x.CloudApplicationUpdateDetails, new { @data_placement = "left", @placeholder = "  Please update:", @rows="8" })
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <!-- SPACE -->
                <div class="span10" style="height:20px;"></div>
                <!-- TC's & USER GROUP -->
                <div class="span10">
                    <div class="span8 xoffset2">
                        <div class="controls-row">      
                            <div class="span8 control-group">
                                <div class="controls">
                                    @Html.CheckBoxFor(x => x.TermsAndConditions, new { @class = "font-13px-white xterms", @data_placement = "top" })
                                    @Html.Partial("PrivacyPolicy")
                                </div>
                            </div>
                            <div class="span8 control-group">
                                <div class="controls">
                                    @Html.CheckBoxFor(x => x.JoinUserGroup)
                                    @Html.LabelFor(m => m.JoinUserGroup, new { @class = "font-normal-13px-black checkbox-label" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sxpan8 xform-actions site-button-container">
                        <div class="site-button">
                            <img    src="@Url.Content("~/Images/Buttons/CCW_Submit.png")"
                                            name="@Html.Encode("APPLICATIONREQUEST_BUTTON")"
                                            id = "cloudwareRegistrationButton"
                                            class="xterms-checked"
                                             />
                        </div>
                    </div>
                </div>
                <!-- SPACE -->
                <div class="span10" style="height:20px;"></div>

                @*                    </form>*@
            }
            </div>
        </div>
    </div>

    <div id="modalconfirmation" class="modal hide fade in modal-cloudware-registration-confirmation">
        <div class="modal-header">  
            <a class="close" data-dismiss="modal">×</a>  
        </div>  
        <div class="modal-body"> 
            <div class="row">
                <div class="sxpan7 xoffset2">
                    <div class="sxpan7 xoffset2">
                            <div class="xcontrols-row">
                                <h5 class="span4 clearfix">We will contact you shortly!</h5>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">  
            <a href="#" class="btn" data-dismiss="modal">OK</a>
        </div>
    </div>                

    <div id="modalconfirmationerror" class="modal hide fade in modal-cloudware-registration-confirmation">
        <div class="modal-header">  
            <a class="close" data-dismiss="modal">×</a>  
        </div>  
        <div class="modal-body"> 
            <div class="row">
                <div class="sxpan7 xoffset2">
                    <div class="sxpan7 xoffset2">
                            <div class="xcontrols-row">
                                <h5 class="span4 clearfix">Unable to service your request at present. Please try later.</h5>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">  
            <a href="#" class="btn" data-dismiss="modal">OK</a>
        </div>
    </div>                

</div>
        
@*        <p><a data-toggle="modal" href="#example" class="btn btn-primary btn-large">Launch demo modal</a></p>  *@



@*        <script src="http://code.jquery.com/jquery-latest.js"></script>*@

@*        <script src="@Url.Content("~/Scripts/jquery.validate.js")" type="text/javascript"></script>*@
@*        <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>*@

<!-- COMMENTED -->
@*        <script src="../../Content/twitter-bootstrap/resources/js/bootstrap.min.js"></script>*@

@*        <script src="../../Content/twitter-bootstrap/resources/js/jquery.validate.js"></script>*@
<!-- COMMENTED -->
@*        <script src="../../Content/twitter-bootstrap/resources/js/jquery.validate.bootstrap.js"></script>*@
       
@*           @Html.Partial("TCDialog")*@

        <script>
            $(document).ready(function () {
                //$('#registerform').validate();
                $.validator.unobtrusive.adapters.addBool("mandatory", "required");
                //debugger;
                var registerOrUpdateContext = $('#registerform');
                var autoShow = $('#AutoShow', registerOrUpdateContext).val();
                if (autoShow.toUpperCase() == "TRUE") {
                    RefreshElements('REGISTER');
                    $('#modalinput').modal('show');
                }
            });

            $('.register-or-update').on('click', function (e) {
                var test = e.target;
                var modalType = $(this).data('id').toUpperCase();
                //debugger;

                $('#modalinput').find('div.control-group').each(function () {
                    var control = $(this).find('.input-validation-error')[0];
                    if (control != null) {
                        //debugger;
                        $(control).popover('hide');
                    }
                    //if ($(this).find('span.field-validation-error').length == 0) {
                    //$(this).removeClass('error');
                    //$(this).popover('hide');
                    //}
                });

                RefreshElements(modalType);
            });

            function RefreshElements(modalType) {
                var isCloudwareUpdate = $('#IsCloudwareUpdate');

                $('#modalinput [placeholder]').each(function () {
                    //debugger;
                    $(this).val('');
                });

                switch (modalType) {
                    case "REGISTER":
                        $('.update').each(function () {
                            //$(this).css("visibility", "hidden");
                            //debugger;
                            $(this).css("display", "none");
                        });
                        $('.register').each(function () {
                            //debugger;
                            $(this).css("display", "");
                        });
                        //debugger;
                        $(isCloudwareUpdate).val('False');

                        var updateDetails = $('#CloudApplicationUpdateDetails')[0];
                        if (updateDetails != null) {
                            //$(updateDetails).text('null');
                            $(updateDetails).val('null');
                        }
                        else {
                            alert('Cannot find update details!')
                        }

                        break;
                    case "UPDATE":
                        $('.register').each(function () {
                            //$(this).css("visibility", "hidden");
                            //debugger;
                            $(this).css("display", "none");
                        });
                        $('.update').each(function () {
                            //debugger;
                            $(this).css("display", "");
                        });
                        //debugger;
                        $(isCloudwareUpdate).val('True');
                        break;
                }
            }

            $('#modalinput').on('show', function () {
                //debugger;
                var test = $(this).data('id');
                var test2 = $(this).data('id');
                //$('form').each(function () {
                //                $(this).find('div.control-group').each(function () {
                //                    debugger;
                //                    if ($(this).find('.field-validation-error').length > 0) {
                //                        $(this).addClass('error');
                //                    }
                //                });
                //});
            });

            $('#modalinput').on('hidden', function () {
                //alert("hidden");
                //$('#modalconfirmation').modal('show');
                //debugger;
                //var test = $(this).data('id');
                //var test2 = $(this).data('id');
                //$('form').each(function () {
                //                $(this).find('div.control-group').each(function () {
                //                    debugger;
                //                    if ($(this).find('.field-validation-error').length > 0) {
                //                        $(this).addClass('error');
                //                    }
                //                });
                //});
            });

            //fires when the submit rating button is clicked
            $('#modalinput').on('click', '#cloudwareRegistrationButton', function () {
                //debugger;

                //if (HasPrivacyPolicyBeenChecked(this)) {
                    var theForm = $('#registerform');
                    //theForm = $('#dummy').parent();
                    theForm.removeData('validator');
                    theForm.removeData('unobtrusiveValidation');
                    $.validator.unobtrusive.parse($(theForm));
                    if ($(theForm).valid()) {
                        //alert('valid');
                        //var serialize1 = $('#xmyform').serialize();
                        //debugger;
                        var serialize1 = $(theForm).serialize();

                        //                setLoading(true);

                        $.ajax({
                            url: 'RegisterCloudware',
                            type: 'POST',
                            data: serialize1,

                            //The request was a success.
                            success: function (data) {
                                //setLoading(false);
                                //$("#dialog-input-review").dialog('close');
                                //dlgRatingReviewCreated.DoSomething();
                                $('#modalinput').modal('hide');
                                $('#modalconfirmation').modal('show');
                            },
                            error: function (data) {
                                //setLoading(false);
                                //alert('Fail on register cloudware');
                                $('#modalinput').modal('hide');
                                $('#modalconfirmationerror').modal('show');
                            }
                        });
                    }
                    else {
                        //alert('not valid');
                        $(theForm).find('div.control-group').each(function () {
                            if ($(this).find('.field-validation-error').length > 0) {
                                //debugger;
                                $(this).addClass('error');
                            }
                        });
                    }
                //}
            });

//            function HasPrivacyPolicyBeenChecked(theObject) {
//                //alert('terms');
//                var formContext = $(theObject).closest("form");
//                var terms = $(".terms",formContext);
//                var isChecked = terms.prop("checked");
//                if (!isChecked) {
//                    AlertToCheckTCs();
//                    return false;
//                }
//                else {
//                    return true;
//                }
//            }

       </script>

@*                                <div class="span4 control-group">
                                    <label for="textbox">Enter Some Text</label>
                                    <div class="controls">
                                        <input type="text" name="textbox" id="textbox" class="span4" title="Error Title"
                                            data-rule-required="true"
                                            data-placement="bottom" />
                                        <ul class="help-block">
                                            <li>This field is reqired.</li>
                                            <li>The Popover will appear below ('data-placement' attribute) the text box.</li>
                                            <li>The title is specified within the 'title' attribute.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="span4 control-group">
                                    <label for="numbers">Enter Some Numbers (1-10)</label>
                                    <div class="controls">
                                        <input type="text" name="numbers" id="numbers" class="span4"
                                            data-rule-range="[1, 10]" 
                                            data-rule-required="true" 
                                            data-title="Number Error"/>
                                        <ul class="help-block">
                                            <li>This field is reqired.</li>
                                            <li>Only numbers between 1 and 10 are allowed.</li>
                                            <li>The Popover will appear to the right (default) of the text box.</li>
                                            <li>The title is specified within the 'data-title' attribute.</li>
                                        </ul>
                                    </div>
                                </div>*@
